<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Formulaire Devis / Facture Professionnel</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter&display=swap');

  body {
    font-family: 'Inter', sans-serif;
    background: #f8f9fa;
    color: #343a40;
    margin: 30px auto;
    max-width: 900px;
    padding: 0 15px 40px;
  }

  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 25px;
    user-select: none;
  }

  .flex-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 25px;
  }

  .flex-row > div {
    flex: 1;
    min-width: 220px;
  }

  label {
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
    color: #495057;
  }

  input[type="text"],
  input[type="date"],
  input[type="number"],
  textarea,
  select {
    border: 1px solid #ced4da;
    border-radius: 6px;
    padding: 8px 10px;
    width: 100%;
    font-size: 0.95rem;
    transition: border-color 0.3s;
    box-sizing: border-box;
  }

  input[type="text"]:focus,
  input[type="date"]:focus,
  input[type="number"]:focus,
  textarea:focus,
  select:focus {
    border-color: #3b82f6;
    outline: none;
    box-shadow: 0 0 6px #3b82f6aa;
  }

  textarea {
    height: 60px;
    resize: vertical;
  }

  .section-info {
    background: #ffffff;
    border-radius: 8px;
    padding: 15px 20px;
    margin-bottom: 25px;
    box-shadow: 0 3px 8px rgb(0 0 0 / 0.1);
  }

  .section-info h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #2c3e50;
    user-select: none;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.1);
    margin-bottom: 25px;
  }

  th, td {
    padding: 12px 15px;
    text-align: center;
    font-size: 0.9rem;
  }

  th {
    background-color: #3b82f6;
    color: white;
    font-weight: 700;
  }

  tbody tr:nth-child(even) {
    background-color: #f1f5f9;
  }

  tbody tr:hover {
    background-color: #dbeafe;
  }

  input.surface,
  input.total-ligne {
    background: #e9ecef;
    border: none;
    pointer-events: none;
  }

  button {
    background-color: #3b82f6;
    border: none;
    padding: 10px 18px;
    color: white;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }

  button:hover {
    background-color: #2563eb;
  }

  .btn-suppr {
    background-color: #ef4444;
    padding: 6px 12px;
    font-size: 0.85rem;
    border-radius: 5px;
  }

  .btn-suppr:hover {
    background-color: #b91c1c;
  }

  #logo-preview {
    max-height: 100px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
    object-fit: contain;
    display: block;
    user-select: none;
  }

  #total-general {
    font-weight: 700;
    font-size: 1.3rem;
    color: #1e293b;
    user-select: none;
  }

  .bottom-buttons {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
  }

  /* Responsive */
  @media (max-width: 600px) {
    .flex-row {
      flex-direction: column;
    }
    .bottom-buttons {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<h1 id="titre-page">Formulaire Devis</h1>

<div class="flex-row">
  <div>
    <label for="type-document">Type :</label>
    <select id="type-document">
      <option value="devis" selected>Devis</option>
      <option value="facture">Facture</option>
    </select>
  </div>
  <div>
    <label for="invoice-number">Numéro :</label>
    <input type="text" id="invoice-number" placeholder="Ex : INV-2025-001" />
  </div>
  <div>
    <label for="date-document">Date :</label>
    <input type="date" id="date-document" />
  </div>
</div>

<div class="section-info">
  <h3>Informations Vendeur</h3>
  <textarea id="info-vendeur" placeholder="Nom société, adresse, téléphone..."></textarea>
</div>

<div class="section-info">
  <h3>Informations Client</h3>
  <textarea id="info-client" placeholder="Nom, adresse, téléphone..."></textarea>
</div>

<div class="section-info">
  <h3>Logo (optionnel)</h3>
  <input type="file" id="logo-upload" accept="image/*" />
  <img id="logo-preview" alt="Aperçu logo" style="display:none" />
</div>

<div class="section-info">
  <h3>TVA (%)</h3>
  <input type="number" id="tva" value="20" min="0" max="100" step="0.01" />
</div>

<table id="table-lignes">
  <thead>
    <tr>
      <th>Désignation</th>
      <th>Prix Unitaire (dh)</th>
      <th>Quantité</th>
      <th>Largeur (cm)</th>
      <th>Hauteur (cm)</th>
      <th>Surface (m²)</th>
      <th>Total (dh)</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="tbody-lignes">
    <tr class="ligne-article">
      <td><input type="text" class="designation" value="Toile PVC" /></td>
      <td><input type="number" class="prix-unitaire" value="15" min="0" step="0.01" /></td>
      <td><input type="number" class="quantite" value="2" min="1" step="1" /></td>
      <td><input type="number" class="largeur" value="120" min="0" step="0.01" /></td>
      <td><input type="number" class="hauteur" value="100" min="0" step="0.01" /></td>
      <td><input type="number" class="surface" value="1.20" readonly /></td>
      <td><input type="number" class="total-ligne" value="36.00" readonly /></td>
      <td><button class="btn-suppr">Supprimer</button></td>
    </tr>
  </tbody>
</table>

<div class="flex-row" style="justify-content: flex-end; align-items: center; gap: 20px; margin-bottom: 25px;">
  <div>
    <strong>Total HT :</strong> <span id="total-ht">0.00</span> dh
  </div>
  <div>
    <strong>TVA (<span id="tva-percent">20</span>%) :</strong> <span id="total-tva">0.00</span> dh
  </div>
  <div>
    <strong>Total TTC :</strong> <span id="total-ttc" style="color:#2563eb; font-weight:700;">0.00</span> dh
  </div>
</div>

<div class="bottom-buttons">
  <button id="btn-ajouter">Ajouter une ligne</button>
  <button id="btn-nouvelle-facture" style="background:#6b7280;">Nouvelle facture</button>
  <button id="btn-generate-pdf">Générer PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<script>
  const { jsPDF } = window.jspdf;

  // Elements
  const selectType = document.getElementById('type-document');
  const titrePage = document.getElementById('titre-page');
  const tvaInput = document.getElementById('tva');
  const tvaPercentDisplay = document.getElementById('tva-percent');
  const tbodyLignes = document.getElementById('tbody-lignes');
  const logoUpload = document.getElementById('logo-upload');
  const logoPreview = document.getElementById('logo-preview');

  const totalHTSpan = document.getElementById('total-ht');
  const totalTVASpan = document.getElementById('total-tva');
  const totalTTCSpan = document.getElementById('total-ttc');

  const btnAjouter = document.getElementById('btn-ajouter');
  const btnNouvelleFacture = document.getElementById('btn-nouvelle-facture');
  const btnGeneratePDF = document.getElementById('btn-generate-pdf');

  // Mise à jour du titre selon type
  selectType.addEventListener('change', () => {
    titrePage.textContent = selectType.value === 'devis' ? 'Formulaire Devis' : 'Formulaire Facture';
  });

  // Fonction calcul surface et total ligne
  function calculerLigne(tr) {
    const prix = parseFloat(tr.querySelector('.prix-unitaire').value) || 0;
    const quantite = parseInt(tr.querySelector('.quantite').value) || 0;
    const largeurCm = parseFloat(tr.querySelector('.largeur').value) || 0;
    const hauteurCm = parseFloat(tr.querySelector('.hauteur').value) || 0;

    const surfaceM2 = ((largeurCm / 100) * (hauteurCm / 100));
    tr.querySelector('.surface').value = surfaceM2.toFixed(2);

    const totalLigne = prix * quantite * surfaceM2;
    tr.querySelector('.total-ligne').value = totalLigne.toFixed(2);

    return totalLigne;
  }

  // Recalcul total global
  function calculerTotals() {
    let totalHT = 0;
    tbodyLignes.querySelectorAll('tr').forEach(tr => {
      totalHT += calculerLigne(tr);
    });

    totalHTSpan.textContent = totalHT.toFixed(2);

    const tva = parseFloat(tvaInput.value) || 0;
    tvaPercentDisplay.textContent = tva.toFixed(2);

    const totalTVA = totalHT * (tva / 100);
    totalTVASpan.textContent = totalTVA.toFixed(2);

    const totalTTC = totalHT + totalTVA;
    totalTTCSpan.textContent = totalTTC.toFixed(2);
  }

  // Ajout d'une nouvelle ligne vide
  function ajouterLigne() {
    const tr = document.createElement('tr');
    tr.classList.add('ligne-article');
    tr.innerHTML = `
      <td><input type="text" class="designation" value="" placeholder="Description" /></td>
      <td><input type="number" class="prix-unitaire" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="quantite" value="1" min="1" step="1" /></td>
      <td><input type="number" class="largeur" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="hauteur" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="surface" value="0" readonly /></td>
      <td><input type="number" class="total-ligne" value="0" readonly /></td>
      <td><button class="btn-suppr">Supprimer</button></td>
    `;
    tbodyLignes.appendChild(tr);
    ajouterListenersLigne(tr);
  }

  // Supprimer une ligne
  tbodyLignes.addEventListener('click', e => {
    if (e.target.classList.contains('btn-suppr')) {
      e.target.closest('tr').remove();
      calculerTotals();
    }
  });

  // Ajouter les événements pour recalculer à chaque changement
  function ajouterListenersLigne(tr) {
    ['input'].forEach(event => {
      tr.querySelectorAll('input').forEach(input => {
        if (!input.classList.contains('surface') && !input.classList.contains('total-ligne')) {
          input.addEventListener(event, calculerTotals);
        }
      });
    });
  }

  // Mettre à jour la prévisualisation logo
  logoUpload.addEventListener('change', () => {
    const file = logoUpload.files[0];
    if (!file) {
      logoPreview.style.display = 'none';
      logoPreview.src = '';
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      logoPreview.src = e.target.result;
      logoPreview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  // Mettre à jour la TVA au changement
  tvaInput.addEventListener('input', calculerTotals);

  // Bouton ajouter ligne
  btnAjouter.addEventListener('click', () => {
    ajouterLigne();
  });

  // Bouton nouvelle facture (réinitialisation)
  btnNouvelleFacture.addEventListener('click', () => {
    if (confirm("Voulez-vous vraiment créer une nouvelle facture ? Toutes les données seront perdues.")) {
      document.getElementById('invoice-number').value = '';
      document.getElementById('date-document').value = '';
      document.getElementById('info-vendeur').value = '';
      document.getElementById('info-client').value = '';
      tvaInput.value = 20;
      tvaPercentDisplay.textContent = '20';
      logoUpload.value = '';
      logoPreview.src = '';
      logoPreview.style.display = 'none';
      tbodyLignes.innerHTML = '';
      ajouterLigne();
      calculerTotals();
    }
  });

  // Génération PDF
  btnGeneratePDF.addEventListener('click', () => {
    const doc = new jsPDF();

    const typeDoc = selectType.value === 'devis' ? 'Devis' : 'Facture';
    doc.setFontSize(18);
    doc.text(typeDoc.toUpperCase(), 14, 22);

    // Logo (si présent)
    if (logoPreview.src) {
      const img = logoPreview;
      // Dessiner le logo max 50x50, position en haut à droite
      doc.addImage(img, 'PNG', 150, 10, 40, 40);
    }

    // Infos facture
    doc.setFontSize(11);
    doc.text(`Numéro : ${document.getElementById('invoice-number').value}`, 14, 35);
    const dateVal = document.getElementById('date-document').value;
    doc.text(`Date : ${dateVal ? new Date(dateVal).toLocaleDateString() : ''}`, 14, 42);

    // Infos vendeur et client
    doc.setFontSize(12);
    doc.text("Vendeur :", 14, 52);
    const vendeur = document.getElementById('info-vendeur').value.trim();
    doc.setFontSize(10);
    doc.splitTextToSize(vendeur, 90).forEach((line, i) => doc.text(line, 14, 58 + i * 6));

    doc.setFontSize(12);
    doc.text("Client :", 110, 52);
    const client = document.getElementById('info-client').value.trim();
    doc.setFontSize(10);
    doc.splitTextToSize(client, 90).forEach((line, i) => doc.text(line, 110, 58 + i * 6));

    // Préparer données tableau lignes
    const dataLignes = [];
    tbodyLignes.querySelectorAll('tr').forEach(tr => {
      const desig = tr.querySelector('.designation').value;
      const prix = parseFloat(tr.querySelector('.prix-unitaire').value).toFixed(2);
      const quantite = tr.querySelector('.quantite').value;
      const largeur = tr.querySelector('.largeur').value;
      const hauteur = tr.querySelector('.hauteur').value;
      const surface = tr.querySelector('.surface').value;
      const totalLigne = parseFloat(tr.querySelector('.total-ligne').value).toFixed(2);
      dataLignes.push([desig, prix, quantite, largeur, hauteur, surface, totalLigne]);
    });

    // Table lignes
    doc.autoTable({
      startY: 90,
      head: [['Désignation', 'Prix Unitaire (dh)', 'Quantité', 'Largeur (cm)', 'Hauteur (cm)', 'Surface (m²)', 'Total (dh)']],
      body: data






ChatGPT a dit :
Lignes,
styles: { fontSize: 8 },
headStyles: { fillColor: [59, 130, 246] },
margin: { left: 14, right: 14 },
});

javascript
Copier
Modifier
// Totaux en bas
const finalY = doc.lastAutoTable.finalY + 10;
doc.setFontSize(12);
doc.text(`Total HT : ${totalHTSpan.textContent} dh`, 14, finalY);
doc.text(`TVA (${tvaInput.value}%) : ${totalTVASpan.textContent} dh`, 14, finalY + 7);
doc.text(`Total TTC : ${totalTTCSpan.textContent} dh`, 14, finalY + 14);

doc.save(`${typeDoc}_${document.getElementById('invoice-number').value || 'sans_numero'}.pdf`);
});

// Initialisation
function init() {
tbodyLignes.querySelectorAll('tr').forEach(ajouterListenersLigne);
calculerTotals();
}

init();
</script>

</body> </html> ```
