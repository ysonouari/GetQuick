<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Formulaire Devis / Facture avec Surface, Logo, TVA</title>
<style>
  /* Reset minimal */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: #f8f9fa;
    color: #333;
    line-height: 1.4;
  }

  h1#titre-page {
    color: #1a237e;
    font-weight: 700;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    color: #3949ab;
  }

  input[type="text"], input[type="date"], input[type="number"], textarea, select {
    width: 100%;
    padding: 8px 10px;
    border: 1.8px solid #c5cae9;
    border-radius: 6px;
    background-color: #fff;
    font-size: 0.95rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, input[type="date"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #1a237e;
    box-shadow: 0 0 5px rgba(26, 35, 126, 0.4);
    background-color: #fff;
  }
  textarea {
    min-height: 80px;
    resize: vertical;
  }

  .section-info {
    background: #e8eaf6;
    border-radius: 8px;
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(26, 35, 126, 0.1);
  }
  .section-info h3 {
    margin-top: 0;
    margin-bottom: 12px;
    font-weight: 700;
    color: #283593;
    border-bottom: 2px solid #3949ab;
    padding-bottom: 6px;
  }

  .flex-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 25px;
  }
  .flex-row > div {
    flex: 1 1 200px;
    min-width: 180px;
  }

  #logo-upload {
    cursor: pointer;
  }
  #logo-preview {
    display: block;
    max-height: 80px;
    margin-top: 10px;
    border-radius: 6px;
    border: 1.5px solid #c5cae9;
    object-fit: contain;
    max-width: 100%;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    margin-bottom: 20px;
    font-size: 0.95rem;
    box-shadow: 0 2px 8px rgb(26 35 126 / 0.1);
    background: #fff;
    border-radius: 8px;
  }
  th, td {
    padding: 12px 10px;
    text-align: center;
    vertical-align: middle;
  }
  thead th {
    background: #3949ab;
    color: #fff;
    font-weight: 700;
    letter-spacing: 0.03em;
    border: none;
    border-radius: 8px 8px 0 0;
  }
  tbody tr {
    background: #f0f4ff;
    border-radius: 6px;
  }
  tbody tr:hover {
    background: #d1d9ff;
  }
  tbody tr td {
    border: none;
  }

  input[type=number] {
    max-width: 100px;
  }
  input.surface, input.total-ligne {
    background: #e3e7ff;
    border: none;
    color: #3f51b5;
    font-weight: 600;
  }

  button {
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    background-color: #3949ab;
    color: white;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-shadow: 0 3px 8px rgb(26 35 126 / 0.3);
  }
  button:hover {
    background-color: #1a237e;
  }
  button:active {
    transform: scale(0.97);
  }

  #btn-nouvelle-facture {
    background-color: #e53935;
    box-shadow: 0 3px 8px rgb(229 57 53 / 0.5);
  }
  #btn-nouvelle-facture:hover {
    background-color: #b71c1c;
  }

  #btn-ajouter {
    margin-bottom: 20px;
  }

  #total-general, #tva-montant, #total-ttc {
    font-weight: 700;
    font-size: 1.3rem;
    margin-right: 20px;
    color: #1a237e;
  }

  /* Responsive */
  @media (max-width: 850px) {
    .flex-row {
      flex-direction: column;
    }
    .flex-row > div {
      min-width: auto;
    }
    table {
      display: block;
      overflow-x: auto;
      white-space: nowrap;
      border-radius: 8px;
    }
    tbody tr {
      display: table-row;
    }
  }

  @media (max-width: 400px) {
    button {
      width: 100%;
      font-size: 1.1rem;
      padding: 12px 0;
    }
    #total-general, #tva-montant, #total-ttc {
      display: block;
      margin: 8px 0;
    }
  }
</style>
</head>
<body>

<h1 id="titre-page">Formulaire Devis</h1>

<div class="flex-row" role="region" aria-label="Sélection type document et informations de base">
  <div>
    <label for="type-document">Type :</label>
    <select id="type-document" aria-describedby="type-document-desc">
      <option value="devis" selected>Devis</option>
      <option value="facture">Facture</option>
    </select>
  </div>
  <div>
    <label for="invoice-number">Numéro :</label>
    <input type="text" id="invoice-number" placeholder="Ex : INV-2025-001" aria-label="Numéro de document" />
  </div>
  <div>
    <label for="date-document">Date :</label>
    <input type="date" id="date-document" aria-label="Date du document" />
  </div>
</div>

<div class="flex-row" role="region" aria-label="Logo et TVA">
  <div>
    <label for="logo-upload">Logo :</label>
    <input type="file" id="logo-upload" accept="image/*" aria-label="Télécharger logo entreprise" />
    <img id="logo-preview" alt="Aperçu logo" />
  </div>
  <div>
    <label for="tva">TVA (%) :</label>
    <input type="number" id="tva" value="20" min="0" step="0.01" aria-label="Taux de TVA" />
  </div>
</div>

<div class="section-info" role="region" aria-label="Informations client">
  <h3>Informations Client</h3>
  <textarea id="info-client" placeholder="Nom, adresse, téléphone..." aria-label="Informations client"></textarea>
</div>

<div class="section-info" role="region" aria-label="Informations vendeur">
  <h3>Informations Vendeur</h3>
  <textarea id="info-vendeur" placeholder="Nom société, adresse, téléphone..." aria-label="Informations vendeur"></textarea>
</div>

<table id="table-lignes" role="grid" aria-label="Liste des lignes d'article">
  <thead>
    <tr>
      <th scope="col">Désignation</th>
      <th scope="col">Prix Unitaire (dh)</th>
      <th scope="col">Quantité</th>
      <th scope="col">Largeur (cm)</th>
      <th scope="col">Hauteur (cm)</th>
      <th scope="col">Surface (m²)</th>
      <th scope="col">Total (dh)</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
  <tbody id="tbody-lignes">
    <tr class="ligne-article">
      <td><input type="text" class="designation" value="Toile PVC" aria-label="Désignation article" /></td>
      <td><input type="number" class="prix-unitaire" value="15" min="0" step="0.01" aria-label="Prix unitaire" /></td>
      <td><input type="number" class="quantite" value="2" min="1" step="1" aria-label="Quantité" /></td>
      <td><input type="number" class="largeur" value="120" min="0" step="0.01" aria-label="Largeur en cm" /></td>
      <td><input type="number" class="hauteur" value="100" min="0" step="0.01" aria-label="Hauteur en cm" /></td>
      <td><input type="number" class="surface" value="1.20" readonly aria-label="Surface en mètres carrés" /></td>
      <td><input type="number" class="total-ligne" value="36.00" readonly aria-label="Total ligne" /></td>
      <td><button class="btn-suppr" aria-label="Supprimer cette ligne">Supprimer</button></td>
    </tr>
  </tbody>
</table>

<button id="btn-ajouter" aria-label="Ajouter une ligne">Ajouter une ligne</button>

<div style="margin-top:15px; display:flex; flex-wrap: wrap; gap: 20px; justify-content: center;">
  <span id="total-general" aria-live="polite" aria-atomic="true">36.00</span><span>dh (HT)</span>
  <span id="tva-montant" aria-live="polite" aria-atomic="true">7.20</span><span>dh (TVA)</span>
  <span id="total-ttc" aria-live="polite" aria-atomic="true">43.20</span><span>dh (TTC)</span>
</div>

<div style="margin-top:20px; display:flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
  <button id="btn-generate-pdf" aria-label="Générer le PDF de la facture">Générer PDF</button>
  <button id="btn-nouvelle-facture" aria-label="Créer une nouvelle facture">Nouvelle facture</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
  /* -- J'ai laissé intact ton script JavaScript, aucun changement ici -- */
  const { jsPDF } = window.jspdf;

  const selectType = document.getElementById('type-document');
  const titrePage = document.getElementById('titre-page');
  const tbodyLignes = document.getElementById('tbody-lignes');
  const totalGeneralSpan = document.getElementById('total-general');
  const tvaInput = document.getElementById('tva');
  const tvaMontantSpan = document.getElementById('tva-montant');
  const totalTTCSpan = document.getElementById('total-ttc');
  const logoUpload = document.getElementById('logo-upload');
  const logoPreview = document.getElementById('logo-preview');

  let logoDataURL = null;

  selectType.addEventListener('change', () => {
    titrePage.textContent = selectType.value === 'devis' ? "Formulaire Devis" : "Formulaire Facture";
  });

  function calculerSurface(largeur, hauteur)






ChatGPT a dit :
{
return (largeur / 100) * (hauteur / 100);
}

function updateLigneTotal(ligne) {
const prixUnitaire = parseFloat(ligne.querySelector('.prix-unitaire').value) || 0;
const quantite = parseInt(ligne.querySelector('.quantite').value) || 0;
const largeur = parseFloat(ligne.querySelector('.largeur').value) || 0;
const hauteur = parseFloat(ligne.querySelector('.hauteur').value) || 0;

csharp
Copier
Modifier
const surface = calculerSurface(largeur, hauteur);
ligne.querySelector('.surface').value = surface.toFixed(2);

const totalLigne = prixUnitaire * quantite * surface;
ligne.querySelector('.total-ligne').value = totalLigne.toFixed(2);
}

function calculerTotals() {
let totalHT = 0;
document.querySelectorAll('.ligne-article').forEach(ligne => {
const totalLigne = parseFloat(ligne.querySelector('.total-ligne').value) || 0;
totalHT += totalLigne;
});

javascript
Copier
Modifier
const tva = parseFloat(tvaInput.value) || 0;
const montantTVA = totalHT * (tva / 100);
const totalTTC = totalHT + montantTVA;

totalGeneralSpan.textContent = totalHT.toFixed(2);
tvaMontantSpan.textContent = montantTVA.toFixed(2);
totalTTCSpan.textContent = totalTTC.toFixed(2);
}

function onInputChange(e) {
const ligne = e.target.closest('.ligne-article');
if (ligne) {
updateLigneTotal(ligne);
calculerTotals();
}
}

tbodyLignes.addEventListener('input', onInputChange);

document.getElementById('btn-ajouter').addEventListener('click', () => {
const nouvelleLigne = document.querySelector('.ligne-article').cloneNode(true);

pgsql
Copier
Modifier
// Réinitialiser les valeurs des inputs
nouvelleLigne.querySelectorAll('input').forEach(input => {
  if (input.classList.contains('surface') || input.classList.contains('total-ligne')) {
    input.value = '0.00';
  } else if (input.type === 'number') {
    input.value = '0';
  } else {
    input.value = '';
  }
});
tbodyLignes.appendChild(nouvelleLigne);
});

tbodyLignes.addEventListener('click', (e) => {
if (e.target.classList.contains('btn-suppr')) {
const lignes = document.querySelectorAll('.ligne-article');
if (lignes.length > 1) {
e.target.closest('tr').remove();
calculerTotals();
} else {
alert("Il doit rester au moins une ligne.");
}
}
});

tvaInput.addEventListener('input', () => {
calculerTotals();
});

logoUpload.addEventListener('change', e => {
const file = e.target.files[0];
if (file && file.type.startsWith('image/')) {
const reader = new FileReader();
reader.onload = ev => {
logoDataURL = ev.target.result;
logoPreview.src = logoDataURL;
};
reader.readAsDataURL(file);
} else {
logoPreview.src = '';
logoDataURL = null;
}
});

function generatePDF() {
const doc = new jsPDF();
const margeGauche = 10;
let y = 10;

javascript
Copier
Modifier
// Logo
if (logoDataURL) {
  doc.addImage(logoDataURL, 'PNG', margeGauche, y, 50, 20);
}

doc.setFontSize(22);
doc.setTextColor("#1a237e");
doc.text(titrePage.textContent, margeGauche + 60, y + 15);

y += 30;

// Infos de base
doc.setFontSize(12);
doc.setTextColor("#333");
doc.text(`Type : ${selectType.value}`, margeGauche, y);
doc.text(`Numéro : ${document.getElementById('invoice-number').value}`, margeGauche + 80, y);
doc.text(`Date : ${document.getElementById('date-document').value}`, margeGauche + 140, y);
y += 15;

// Info client
doc.setFontSize(14);
doc.setTextColor("#3949ab");
doc.text("Informations Client :", margeGauche, y);
y += 8;
doc.setFontSize(12);
const clientText = document.getElementById('info-client').value;
doc.splitTextToSize(clientText, 180).forEach(line => {
  doc.text(line, margeGauche, y);
  y += 7;
});

y += 10;

// Info vendeur
doc.setFontSize(14);
doc.setTextColor("#3949ab");
doc.text("Informations Vendeur :", margeGauche, y);
y += 8;
doc.setFontSize(12);
const vendeurText = document.getElementById('info-vendeur').value;
doc.splitTextToSize(vendeurText, 180).forEach(line => {
  doc.text(line, margeGauche, y);
  y += 7;
});

y += 10;

// Table lignes
const lignesData = [];
document.querySelectorAll('.ligne-article').forEach(ligne => {
  lignesData.push([
    ligne.querySelector('.designation').value,
    ligne.querySelector('.prix-unitaire').value,
    ligne.querySelector('.quantite').value,
    ligne.querySelector('.largeur').value,
    ligne.querySelector('.hauteur').value,
    ligne.querySelector('.surface').value,
    ligne.querySelector('.total-ligne').value,
  ]);
});

doc.autoTable({
  head: [['Désignation', 'Prix Unitaire', 'Quantité', 'Largeur', 'Hauteur', 'Surface', 'Total']],
  body: lignesData,
  startY: y,
  styles: { halign: 'center' },
  headStyles: { fillColor: '#3949ab', textColor: '#fff' },
  margin: { left: margeGauche, right: margeGauche },
});

y = doc.lastAutoTable.finalY + 10;

doc.setFontSize(12);
doc.text(`Total HT : ${totalGeneralSpan.textContent} dh`, margeGauche, y);
y += 7;
doc.text(`TVA (${tvaInput.value}%) : ${tvaMontantSpan.textContent} dh`, margeGauche, y);
y += 7;
doc.text(`Total TTC : ${totalTTCSpan.textContent} dh`, margeGauche, y);

doc.save(`${selectType.value}_${document.getElementById('invoice-number').value || 'document'}.pdf`);
}

document.getElementById('btn-generate-pdf').addEventListener('click', () => {
generatePDF();
});

document.getElementById('btn-nouvelle-facture').addEventListener('click', () => {
if (confirm("Voulez-vous créer une nouvelle facture ? Toutes les données seront effacées.")) {
location.reload();
}
});

// Initial calc
document.querySelectorAll('.ligne-article').forEach(updateLigneTotal);
calculerTotals();
</script>

</body> </html> ```
