<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Formulaire Devis avec Surface</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  th {
    background: #f0f0f0;
  }
  input[type=number] {
    width: 80px;
  }
  input.surface, input.total-ligne {
    background: #eee;
    border: none;
  }
  button {
    margin-top: 10px;
  }
  #total-general {
    font-weight: bold;
    font-size: 1.2em;
  }
</style>
</head>
<body>

<h1>Formulaire Devis</h1>

<table id="table-lignes">
  <thead>
    <tr>
      <th>Désignation</th>
      <th>Prix Unitaire (€)</th>
      <th>Quantité</th>
      <th>Largeur (cm)</th>
      <th>Hauteur (cm)</th>
      <th>Surface (m²)</th>
      <th>Total (€)</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="tbody-lignes">
    <tr class="ligne-article">
      <td><input type="text" class="designation" value="Toile PVC" /></td>
      <td><input type="number" class="prix-unitaire" value="15" min="0" step="0.01" /></td>
      <td><input type="number" class="quantite" value="2" min="1" step="1" /></td>
      <td><input type="number" class="largeur" value="120" min="0" step="0.01" /></td>
      <td><input type="number" class="hauteur" value="100" min="0" step="0.01" /></td>
      <td><input type="number" class="surface" value="1.20" readonly /></td>
      <td><input type="number" class="total-ligne" value="36.00" readonly /></td>
      <td><button class="btn-suppr">Supprimer</button></td>
    </tr>
  </tbody>
</table>

<button id="btn-ajouter">Ajouter une ligne</button>

<p>Total général : <span id="total-general">36.00</span> €</p>

<script>
  // Calcul surface (m²)
  function calculerSurface(largeur, hauteur) {
    return (largeur * hauteur) / 10000;
  }

  // Calcul total ligne
  function calculerTotalLigne(surface, prixUnitaire, quantite) {
    return surface * prixUnitaire * quantite;
  }

  // Met à jour une ligne en recalculant surface et total
  function mettreAJourLigne(ligne) {
    const largeur = parseFloat(ligne.querySelector('.largeur').value) || 0;
    const hauteur = parseFloat(ligne.querySelector('.hauteur').value) || 0;
    const prixUnitaire = parseFloat(ligne.querySelector('.prix-unitaire').value) || 0;
    const quantite = parseInt(ligne.querySelector('.quantite').value) || 0;

    const surface = calculerSurface(largeur, hauteur);
    ligne.querySelector('.surface').value = surface.toFixed(4);

    const total = calculerTotalLigne(surface, prixUnitaire, quantite);
    ligne.querySelector('.total-ligne').value = total.toFixed(2);
  }

  // Met à jour le total général
  function mettreAJourTotalGeneral() {
    let totalGeneral = 0;
    document.querySelectorAll('.ligne-article').forEach(ligne => {
      const totalLigne = parseFloat(ligne.querySelector('.total-ligne').value) || 0;
      totalGeneral += totalLigne;
    });
    document.getElementById('total-general').textContent = totalGeneral.toFixed(2);
  }

  // Mise à jour complète : toutes les lignes + total général
  function miseAJourComplete() {
    document.querySelectorAll('.ligne-article').forEach(ligne => {
      mettreAJourLigne(ligne);
    });
    mettreAJourTotalGeneral();
  }

  // Ajouter une nouvelle ligne vide
  function ajouterLigne() {
    const tbody = document.getElementById('tbody-lignes');
    const nouvelleLigne = document.createElement('tr');
    nouvelleLigne.classList.add('ligne-article');
    nouvelleLigne.innerHTML = `
      <td><input type="text" class="designation" value="" /></td>
      <td><input type="number" class="prix-unitaire" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="quantite" value="1" min="1" step="1" /></td>
      <td><input type="number" class="largeur" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="hauteur" value="0" min="0" step="0.01" /></td>
      <td><input type="number" class="surface" value="0.0000" readonly /></td>
      <td><input type="number" class="total-ligne" value="0.00" readonly /></td>
      <td><button class="btn-suppr">Supprimer</button></td>
    `;
    tbody.appendChild(nouvelleLigne);
  }

  // Gestion suppression ligne
  function supprimerLigne(button) {
    const ligne = button.closest('tr');
    ligne.remove();
    miseAJourComplete();
  }

  // Événements
  document.getElementById('btn-ajouter').addEventListener('click', () => {
    ajouterLigne();
  });

  document.getElementById('tbody-lignes').addEventListener('click', (e) => {
    if (e.target.classList.contains('btn-suppr')) {
      supprimerLigne(e.target);
    }
  });

  document.getElementById('tbody-lignes').addEventListener('input', (e) => {
    const target = e.target;
    if (['prix-unitaire', 'quantite', 'largeur', 'hauteur'].some(c => target.classList.contains(c))) {
      const ligne = target.closest('tr');
      mettreAJourLigne(ligne);
      mettreAJourTotalGeneral();
    }
  });

  // Initialisation du tableau
  miseAJourComplete();
</script>

</body>
</html>
